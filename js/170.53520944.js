"use strict";(self["define"]=self["define"]||[]).push([[170],{92427:function(e,a,n){n.r(a),n.d(a,{default:function(){return j}});n(11723),n(24611),n(26913);var s=n(93826),l=n(17336),i=n(95980),t=n(19812),r=n(55893),o=n(44220);const c={key:0,class:"step1"},u=(0,t._)("span",null,[(0,t.Uk)("点击选择成就页面截图（支持多选）"),(0,t._)("br"),(0,t.Uk)("或拖动图片到这里")],-1),d={class:"list"},g=(0,t._)("p",null,[(0,t.Uk)(" 请上传完整的成就页面截图 "),(0,t._)("br"),(0,t.Uk)(" 如无法多选请更换浏览器 ")],-1),p={class:"image-content"},v=["src"],m={key:1,class:"step2"},f={class:"inline-status"};function h(e,a,n,h,w,k){const y=(0,t.up)("Loader"),D=(0,t.up)("fa-icon"),_=i.GT,C=l.Mr,F=s.Xh,H=(0,t.up)("float-content"),z=(0,t.Q2)("elloading");return(0,t.wg)(),(0,t.iD)("div",null,[e.load?((0,t.wg)(),(0,t.iD)("div",{key:1,class:(0,r.C_)(e.$style.listContainer)},[1===e.step?((0,t.wg)(),(0,t.iD)("div",c,[(0,t._)("div",{class:"top",style:(0,r.j5)(e.images.length>0?{}:{padding:0})},[(0,t._)("div",{class:(0,r.C_)(["dropzone",{"drag-over":e.dragOver}]),onDragover:a[2]||(a[2]=(0,o.iM)((a=>e.dragOver=!0),["prevent","stop"])),onDragleave:a[3]||(a[3]=a=>e.dragOver=!1),onDrop:a[4]||(a[4]=(0,o.iM)(((...a)=>e.onFileDrop&&e.onFileDrop(...a)),["prevent","stop"])),onClick:a[5]||(a[5]=(...a)=>e.dropzoneClick&&e.dropzoneClick(...a))},[(0,t._)("i",null,[(0,t.Wm)(D,{icon:"inbox"})]),u,(0,t._)("input",{ref:"fileInput",multiple:"",class:"file-input",type:"file",accept:"image/*",onChange:a[1]||(a[1]=(...a)=>e.onFileChange&&e.onFileChange(...a))},null,544)],34),e.images.length>0?((0,t.wg)(),(0,t.iD)("button",{key:0,onClick:a[6]||(a[6]=a=>e.step++)},"识别")):(0,t.kq)("",!0)],4),(0,t.wy)(((0,t.wg)(),(0,t.iD)("div",d,[(0,t.Wm)(C,null,{default:(0,t.w5)((()=>[e.images.length<=0?((0,t.wg)(),(0,t.j4)(_,{key:0},{description:(0,t.w5)((()=>[g])),_:1})):(0,t.kq)("",!0),(0,t._)("div",p,[((0,t.wg)(!0),(0,t.iD)(t.HY,null,(0,t.Ko)(e.images,(e=>((0,t.wg)(),(0,t.iD)("img",{key:e.id,src:e.src},null,8,v)))),128))])])),_:1})])),[[z,e.loading]])])):(0,t.kq)("",!0),2===e.step?((0,t.wg)(),(0,t.iD)("div",m,[(0,t.Wm)(F,{type:"circle",percentage:e.progress||0,format:e=>e.toFixed(2)+"%"},null,8,["percentage","format"]),(0,t._)("div",f,[(0,t.Wm)(H,{"in-float":!1,capture:!1,state:1,success:e.recognized.success,fail:e.recognized.fail,scanned:e.scanned,duplicate:e.dup},null,8,["success","fail","scanned","duplicate"])])])):(0,t.kq)("",!0)],2)):((0,t.wg)(),(0,t.j4)(y,{key:0,onDone:a[0]||(a[0]=a=>e.load=!0)}))])}n(85827);var w=n(20521),k=n(72660),y=n(40192),D=n(54063),_=n(1607),C=n(14287),F=n(53389),H=(n(92542),n(86463)),z=n.n(H),L=n(13065),I=n(12507),O=n(77225),U=n(21277);_.vI.add(C.wK3);var q=(0,t.aZ)({components:{Loader:k.Z,FloatContent:O.Z},directives:{elloading:F.t},setup(){const e=(0,w.iH)(!1),a=(0,w.iH)(!1),n=(0,w.iH)(1);if(!y.KL)return{load:e};const{scannerOnLine:s,scannerOnLine2:l,scannerOnImage:i}=(0,D.zG)(),r=(0,w.iH)(null),o=(0,w.iH)([]),c=(0,w.iH)(!1),u=()=>{r.value&&r.value.click()},d=e=>{if(!e.dataTransfer)return;c.value=!1;const a=e.dataTransfer.files;p(a)},g=e=>{const a=e.target.files;a&&p(a)},p=async e=>{o.value=[],a.value=!0;const n=Array.from(e).map(((e,a)=>{const n=new FileReader;return n.readAsDataURL(e),new Promise((e=>{n.onload=()=>{const s=new Image;s.src=n.result,s.id="rcycle-img-"+a,s.onload=()=>{e(s)}}}))}));o.value=await Promise.all(n),a.value=!1},v=(0,w.iH)([]),m=(0,w.iH)(0),f=(0,w.iH)(0),h=(0,t.Fl)((()=>({success:v.value.filter((e=>e.success)).length,fail:v.value.filter((e=>!e.success)).length}))),k=(0,t.Fl)((()=>(h.value.success+h.value.fail+m.value)/f.value*100));(0,t.YP)([o,h,m],(()=>{(0,U.l)("progress",{scanned:o.value.length,...h.value,dup:m.value})}));const _=(0,L.yj)(),C=(0,w.iH)(!1),F=async({image:e,thread:a})=>{if(!e)return;let n=s;a&&C.value&&(n=l);const i=await n(e);if(i.success){const a=v.value.find((e=>{if(!e.success)return!1;const a=e;return a.achievement.id===i.achievement.id}));i.done&&!_.query.withImage||(i.images={main:(0,I.rT)(e).toDataURL()}),a?m.value++:v.value.push(i)}else i.images={main:(0,I.rT)(e).toDataURL()},v.value.push(i),(new Image).src=i.images.main},H=z().promise(F,2),O=async e=>{const a=(0,I.eW)(e),n=await i(a,!0,!0),s=n.reduce(((e,a)=>e+a.image.rows),0);for(const l of n)l.image.rows>s/n.length*2/3&&(H.push({image:l.image,thread:f.value%2===0}),f.value++)},q=z().promise(O,1);async function P(){H.killAndDrain(),H.pause();let e=Promise.resolve();o.value.forEach((a=>{e=q.push(a)})),H.resume(),await e,C.value=!0,console.log("processing"),(0,U.l)("state","processing"),await H.push({image:null,thread:!1}),(0,U.l)("state","finish"),(0,U.l)("result",{result:v.value,dup:m.value})}return(0,t.YP)(n,(e=>{2===e&&P()})),{step:n,load:e,loading:a,onFileDrop:d,onFileChange:g,dropzoneClick:u,fileInput:r,dragOver:c,images:o,progress:k,recognized:h,results:v,dup:m,scanned:f}}}),P={listContainer:"list-container-d28269"},T=n(48998);const W={};W["$style"]=P;const b=(0,T.Z)(q,[["render",h],["__cssModules",W]]);var j=b}}]);