"use strict";(self["define"]=self["define"]||[]).push([[812],{89018:function(e,s,l){l.r(s),l.d(s,{default:function(){return Z}});l(11723),l(26913);var a=l(93826),n=l(95980),i=l(19812),t=l(55893),r=l(44220);const c={key:0,class:"step1"},o=(0,i._)("span",null,[(0,i.Uk)("拖动第三方工具导出的图片集到这里"),(0,i._)("br"),(0,i.Uk)("或点击选择文件（支持多选）")],-1),u={class:"list"},d=["src"],g={key:1,class:"step2"},p={class:"inline-status"};function m(e,s,l,m,v,f){const h=(0,i.up)("Loader"),y=(0,i.up)("fa-icon"),w=n.GT,k=(0,i.up)("DynamicScrollerItem"),D=(0,i.up)("DynamicScroller"),C=a.Xh,_=(0,i.up)("float-content"),F=(0,i.Q2)("elloading");return(0,i.wg)(),(0,i.iD)("div",null,[e.load?((0,i.wg)(),(0,i.iD)("div",{key:1,class:(0,t.C_)(e.$style.listContainer)},[1===e.step?((0,i.wg)(),(0,i.iD)("div",c,[(0,i._)("div",{class:"top",style:(0,t.j5)(e.images.length>0?{}:{padding:0})},[(0,i._)("div",{class:(0,t.C_)(["dropzone",{"drag-over":e.dragOver}]),onDragover:s[2]||(s[2]=(0,r.iM)((s=>e.dragOver=!0),["prevent","stop"])),onDragleave:s[3]||(s[3]=s=>e.dragOver=!1),onDrop:s[4]||(s[4]=(0,r.iM)(((...s)=>e.onFileDrop&&e.onFileDrop(...s)),["prevent","stop"])),onClick:s[5]||(s[5]=(...s)=>e.dropzoneClick&&e.dropzoneClick(...s))},[(0,i._)("i",null,[(0,i.Wm)(y,{icon:"inbox"})]),o,(0,i._)("input",{ref:"fileInput",multiple:"",class:"file-input",type:"file",accept:"image/*",onChange:s[1]||(s[1]=(...s)=>e.onFileChange&&e.onFileChange(...s))},null,544)],34),e.images.length>0?((0,i.wg)(),(0,i.iD)("button",{key:0,onClick:s[6]||(s[6]=s=>e.step++)},"识别")):(0,i.kq)("",!0)],4),(0,i.wy)(((0,i.wg)(),(0,i.iD)("div",u,[(0,i.Wm)(D,{items:e.images,"min-item-size":52,"custom-scrollbar":e.CustomElScrollVue,class:"scroller","key-field":"id"},{before:(0,i.w5)((()=>[e.images.length<=0?((0,i.wg)(),(0,i.j4)(w,{key:0,description:"请添加图片"})):(0,i.kq)("",!0)])),default:(0,i.w5)((({item:e,active:s})=>[(0,i.Wm)(k,{item:e,active:s,"size-dependencies":[]},{default:(0,i.w5)((()=>[(0,i._)("img",{src:e.src},null,8,d)])),_:2},1032,["item","active"])])),_:1},8,["items","custom-scrollbar"])])),[[F,e.loading]])])):(0,i.kq)("",!0),2===e.step?((0,i.wg)(),(0,i.iD)("div",g,[(0,i.Wm)(C,{type:"circle",percentage:e.progress,format:e=>e.toFixed(2)+"%"},null,8,["percentage","format"]),(0,i._)("div",p,[(0,i.Wm)(_,{"in-float":!1,capture:!1,state:1,success:e.recognized.success,fail:e.recognized.fail,scanned:e.images.length,duplicate:e.dup},null,8,["success","fail","scanned","duplicate"])])])):(0,i.kq)("",!0)],2)):((0,i.wg)(),(0,i.j4)(h,{key:0,onDone:s[0]||(s[0]=s=>e.load=!0)}))])}var v=l(20521),f=l(72660),h=l(40192),y=l(54063),w=l(73823),k=l(97067),D=l(1607),C=l(14287),_=l(53389),F=(l(92542),l(86463)),z=l.n(F),H=l(13065),I=l(12507),W=l(77225),b=l(21277);D.vI.add(C.wK3);var L=(0,i.aZ)({components:{Loader:f.Z,FloatContent:W.Z,DynamicScroller:k.cV,DynamicScrollerItem:k.Wk},directives:{elloading:_.t},setup(){const e=(0,v.iH)(!1),s=(0,v.iH)(!1),l=(0,v.iH)(1);if(!h.KL)return{load:e};const a=(0,v.iH)(null),n=(0,v.iH)([]),t=(0,v.iH)(!1),r=()=>{a.value&&a.value.click()},c=e=>{if(!e.dataTransfer)return;t.value=!1;const s=e.dataTransfer.files;u(s)},o=e=>{const s=e.target.files;s&&u(s)},u=async e=>{n.value=[],s.value=!0;const l=Array.from(e).map(((e,s)=>{const l=new FileReader;return l.readAsDataURL(e),new Promise((e=>{l.onload=()=>{const a=new Image;a.src=l.result,a.id="rcycle-img-"+s,a.onload=()=>{e(a)}}}))}));n.value=await Promise.all(l),s.value=!1},d=(0,v.iH)([]),g=(0,v.iH)(0),p=(0,i.Fl)((()=>({success:d.value.filter((e=>e.success)).length,fail:d.value.filter((e=>!e.success)).length}))),m=(0,i.Fl)((()=>(p.value.success+p.value.fail+g.value)/n.value.length*100));(0,i.YP)([n,p,g],(()=>{(0,b.l)("progress",{scanned:n.value.length,...p.value,dup:g.value})}));const f=(0,H.yj)(),k=async({image:e,thread:s})=>{let l=_;s&&(l=F);const a=await(0,I.eW)(e),n=await l(a);if(n.success){const s=d.value.find((e=>{if(!e.success)return!1;const s=e;return s.achievement.id===n.achievement.id}));n.done&&!f.query.withImage||(n.images={main:e.src}),s?g.value++:d.value.push(n)}else n.images={main:e.src},d.value.push(n),(new Image).src=n.images.main},D=z().promise(k,2);async function C(){D.killAndDrain(),D.pause();let e=Promise.resolve();n.value.forEach(((s,l)=>{e=D.push({image:s,thread:l%2===0})})),D.resume(),await e,(0,b.l)("state","finish"),(0,b.l)("result",{result:d.value,dup:g.value})}(0,i.YP)(l,(e=>{2===e&&C()}));const{scannerOnLine:_,scannerOnLine2:F}=(0,y.zG)();return{step:l,load:e,loading:s,onFileDrop:c,onFileChange:o,dropzoneClick:r,fileInput:a,dragOver:t,CustomElScrollVue:w.Z,images:n,progress:m,recognized:p,results:d,dup:g}}}),O={listContainer:"list-container-a866fd"},S=l(48998);const q={};q["$style"]=O;const P=(0,S.Z)(L,[["render",m],["__cssModules",q]]);var Z=P}}]);